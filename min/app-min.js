var express=require("express"),pg=require("pg"),path=require("path"),bodyParser=require("body-parser"),connectionString="pg://localhost:5432/yesvsno",client=new pg.Client(connectionString);client.connect(function(e){return e?console.error("could not connect to postgres",e):void 0});var app=express();app.use(bodyParser.urlencoded({extended:!1})),app.use(bodyParser.json());var port=process.env.PORT||3e3;app.listen(port,function(){console.log("Yes vs no is running on PORT"+port)});var router=express.Router();app.use("/api",router),app.use(express["static"](__dirname+"/public")),console.log(path.join(__dirname+"/public/index.html")),app.get("/",function(e,o){o.sendFile(path.join(__dirname+"/public/index.html"))}),router.route("/comments").get(function(e,o){var n=client.query("SELECT * FROM comments ORDER BY level");n.on("row",function(e,o){o.addRow(e)}),n.on("end",function(e){o.json(e.rows,null,"    ")})}),router.route("/comments/new").post(function(e,o){console.log("Trying to Post");var n={canvass_id:e.body.canvass_id,comment_date:e.body.comment_date,comment_user:e.body.comment_user,comment:e.body.comment,level:e.body.level,tier:e.body.tier,comment_parent_id:e.body.comment_parent_id,comment_vote:e.body.comment_vote};console.log("Data Object"),console.log(e.body),client.query("INSERT INTO comments(canvass_id, comment_date, comment_user, comment, level, tier, comment_parent_id, comment_vote) values($1, $2, $3, $4, $5, $6, $7, $8)",[n.canvass_id,n.comment_date,n.comment_user,n.comment,n.level,n.tier,n.comment_parent_id,n.comment_vote]);var t=client.query("SELECT * FROM comments ORDER BY id");t.on("row",function(e,o){o.addRow(e)}),t.on("end",function(e){o.json(e.rows,null,"    ")})});