!function(){var e=angular.module("yvn.canvass");e.directive("comments",["getComments","$http",function(e,n){return{restrict:"E",scope:{data:"=?"},templateUrl:"app/canvass/directives/comment.html",controller:function(o){if(o.data)o.comments=o.data;else{var t=function(e){var n=_.orderBy(e,["tier"],["desc"]);_.each(n,function(n){console.log(n.comment_user);var o=_.filter(e,function(e){return e.id==n.comment_parent_id});o[0]&&(o[0].comments=[],o[0].comments.push(n))});var o=_.filter(e,function(e){return 0==e.comment_parent_id});return o};o.comments=[];var m=function(){e.comments().success(function(e){console.log("data"),console.log(e),o.comments=t(e),console.log("$scope.comments"),console.log(o.comments)})};m()}o.addPostComment=function(e,t){if(console.log(t),e)var c={canvass_id:101,comment_date:new Date,comment:t,level:0,comment_user:"Dom Marley",comment_parent_id:e.id,tier:e.tier+1,comment_vote:"Two"};n.post("/api/comments/new",c).then(function s(e){m()},function i(e){console.log("Error In Posting?")}),o.userComment=""},o.toggleCommentMenu=function(e){void 0==e.commentMenuVisible||0==e.commentMenuVisible?e.commentMenuVisible=!0:1==e.commentMenuVisible&&(e.commentMenuVisible=!1)}}}}])}();