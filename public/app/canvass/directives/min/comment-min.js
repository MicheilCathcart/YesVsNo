!function(){var e=angular.module("yvn.canvass");e.directive("comments",["getComments","$http",function(e,t){return{restrict:"E",scope:{data:"=?"},templateUrl:"app/canvass/directives/comment.html",controller:function(n){n.userComment="";var m=function(e){var t=_.orderBy(e,["tier"],["desc"]);_.each(t,function(t){var n=_.filter(e,function(e){return e.id==t.comment_parent_id});n[0]&&(n[0].comments||(n[0].comments=[]),n[0].comments.push(t))});var n=_.filter(e,function(e){return 0==e.comment_parent_id});return n},o=function(){console.log("Run Load Comments"),n.comments=[],e.comments().success(function(e){n.comments=m(e),console.log(n.comments)})};n.data?(n.comments=[],n.comments=n.data):(n.comments=[],o()),n.addPostComment=function(e){var n=[{userName:"Mary Sue",commentVote:"One"},{userName:"Jane Placemat",commentVote:"One"},{userName:"Donald Trumpet",commentVote:"Two"},{userName:"Jessica Cathcart",commentVote:"One"},{userName:"Magnus Opum",commentVote:"Two"},{userName:"Bigfoot Rebound",commentVote:"One"},{userName:"Total Recall",commentVote:"Two"},{userName:"Nice Party",commentVote:"Two"},{userName:"Legitimate Name",commentVote:"One"}],m=function(){return n[Math.floor(9*Math.random())]};if(e)var o=m(),c={canvass_id:101,comment_date:new Date,comment:e.userComment,level:0,comment_user:o.userName,comment_parent_id:e.id,tier:e.tier+1,comment_vote:o.commentVote};t.post("/api/comments/new",c).then(function s(t){e&&(e.comments||(e.comments=[]),e.comments.push(t.data[0]),e.commentMenuVisible=!1),e.userComment=""},function a(e){console.log("Error In Posting"),console.log(e)})},n.toggleCommentMenu=function(e){void 0==e.commentMenuVisible||0==e.commentMenuVisible?e.commentMenuVisible=!0:1==e.commentMenuVisible&&(e.commentMenuVisible=!1)}}}}])}();