!function(){var e=angular.module("yvn.canvass");e.directive("votePlot",["$log",function(e){function o(o,t){o.votes=[{user:"Jim Jones",age:27,location:"127.2234562, 127.123456",gender:"male",income:"10,000 - 20,000",ideology:"socialist",religion:"agnostic",vote:"No",date:"2012-04-22T12:00:00+10:00"},{user:"Jeff Barber",age:22,location:"127.2234562, 127.123456",gender:"male",income:"10,000 - 20,000",ideology:"socialist",religion:"athiest",vote:"Yes",date:"2012-04-23T09:00:00+10:00"},{user:"Tammy Cuskelly",age:11,location:"127.2234562, 127.123456",gender:"female",income:"12,000 - 30,000",ideology:"communist",religion:"buddist",vote:"No",date:"2012-04-24T00:00:00+10:00"},{user:"Bridgette Random",age:63,location:"127.2234562, 127.123456",gender:"female",income:"10,000 - 20,000",ideology:"liberal",religion:"christian",vote:"No",date:"2012-04-25T23:00:00+10:00"},{user:"Jim Jones",age:27,location:"127.2234562, 127.123456",gender:"male",income:"10,000 - 20,000",ideology:"socialist",religion:"agnostic",vote:"No",date:"2012-04-26T22:00:00+10:00"},{user:"Jeff Barber",age:22,location:"127.2234562, 127.123456",gender:"male",income:"10,000 - 20,000",ideology:"socialist",religion:"athiest",vote:"No",date:"2012-04-27T21:00:00+10:00"},{user:"Tammy Cuskelly",age:11,location:"127.2234562, 127.123456",gender:"female",income:"12,000 - 30,000",ideology:"communist",religion:"buddist",vote:"Yes",date:"2012-04-28T13:00:00+10:00"},{user:"Bridgette Random",age:63,location:"127.2234562, 127.123456",gender:"female",income:"10,000 - 20,000",ideology:"liberal",religion:"christian",vote:"No",date:"2012-04-29T01:00:00+10:00"},{user:"Jim Jones",age:27,location:"127.2234562, 127.123456",gender:"male",income:"10,000 - 20,000",ideology:"communist",religion:"agnostic",vote:"Yes",date:"2012-04-26T15:00:00+10:00"},{user:"Jeff Barber",age:22,location:"127.2234562, 127.123456",gender:"male",income:"10,000 - 20,000",ideology:"socialist",religion:"athiest",vote:"Yes",date:"2012-04-27T17:00:00+10:00"},{user:"Tammy Cuskelly",age:11,location:"127.2234562, 127.123456",gender:"female",income:"12,000 - 30,000",ideology:"communist",religion:"buddist",vote:"Yes",date:"2012-05-01T13:00:00+10:00"},{user:"Bridgette Random",age:63,location:"127.2234562, 127.123456",gender:"female",income:"10,000 - 20,000",ideology:"liberal",religion:"christian",vote:"Yes",date:"2012-05-01T01:00:00+10:00"}],o.votes.sort(function(e,o){return new Date(e.date)-new Date(o.date)}),o.firstVote=moment(o.votes[0].date).hour(0).minute(0).second(0),o.lastVote=moment(o.votes[o.votes.length-1].date).hour(24).minute(0).second(0),o.days=[];var i=moment(o.votes[0].date).hour(0).minute(0).second(0);for(o.days.push(moment(i).toDate());i.isBefore(o.lastVote);)o.days.push(moment(i).add(1,"days").toDate()),i.add(1,"days");var n=0;o.highestPosition=0,o.lowestPosition=0;var a;_.each(o.votes,function(e){"Yes"==e.vote&&(n++,o.highestPosition++),"No"==e.vote&&(n--,o.lowestPosition++),e.votePosition=n,a=Math.max(o.lowestPosition,o.highestPosition)}),e.info("High"),e.info(o.lowestPosition),e.info("Low"),e.info(o.highestPosition),o.scaleX=d3.time.scale(),o.scaleX.domain([o.firstVote,o.lastVote]),o.scaleX.range([0,100]),o.scaleY=d3.scale.linear(),o.scaleY.domain([-a,a]),o.scaleY.range([110,-110])}function t(e,o,t,i){e.returnDate=function(e){return new Date(e)},e.returnDayOfMonth=function(e){return 1==moment(e).date()?!0:!1},e.findPercentage=function(e,o){return e/(e+o)}}return{restrict:"E",scope:{votes:"="},templateUrl:"app/canvass/directives/vote-plot.html",link:t,controller:o}}])}();